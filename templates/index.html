<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"> <!-- Define la codificación de caracteres para admitir tildes y caracteres especiales -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Permite que la página sea responsive -->
    <title>Generador de Combos</title> <!-- Título de la pestaña en el navegador -->

    <!-- Enlace al archivo de estilos CSS externo -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Estilos internos para la tabla y botones -->
    <style>
        /* Configuración general de la tabla */
        .combo-table {
            width: 100%; /* La tabla ocupa todo el ancho disponible */
            border-collapse: collapse; /* Elimina el espacio entre bordes de celdas */
            margin-top: 20px; /* Margen superior para separación */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra ligera para diseño */
        }
        /* Estilos generales para celdas */
        .combo-table th, .combo-table td {
            border: 1px solid #ddd; /* Borde gris claro */
            padding: 12px; /* Espaciado interno */
            text-align: left; /* Alineación de texto */
        }
        /* Encabezados de la tabla */
        .combo-table th {
            background-color: #4CAF50; /* Color verde de fondo */
            color: white; /* Texto en color blanco */
            text-align: left; /* Alinear títulos a la izquierda */
            font-weight: bold; /* Negrita */
        }
        /* Alternar colores en las filas */
        .combo-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        /* Efecto hover al pasar el cursor */
        .combo-table tr:hover {
            background-color: #ddd;
        }
        /* Alinear la última columna (Costo) a la derecha */
        .combo-table td:last-child {
            text-align: right;
            font-weight: bold;
        }
        /* Contenedor de plataformas en formato de cuadrícula */
        .platforms-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr); /* Se distribuyen en 6 columnas */
            gap: 10px; /* Espaciado entre elementos */
        }
        /* Estilos para botones verdes */
        .btn-green {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        /* Cambio de color al pasar el cursor sobre el botón */
        .btn-green:hover {
            background-color: #218838;
        }
        /* Estilo para el logo */
        .logo {
            display: block;
            margin: 0 auto 20px; /* Centrar la imagen */
            max-width: 150px; /* Ajustar tamaño */
        }
        /* Estilo del pie de página */
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #555;
        }
        .footer img {
            width: 20px;
            vertical-align: middle;
        }
        /* Estilos para el modal */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 1; /* Se sitúa por encima de otros elementos */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* Fondo semi-transparente */
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            border-radius: 10px;
            max-height: 70vh; /* Altura máxima del modal */
            overflow-y: auto; /* Scroll vertical */
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>

    <script>
        let allSelected = false; // Variable para rastrear si todas las plataformas están seleccionadas

        // Función para seleccionar o deseleccionar todas las plataformas
        function toggleSeleccionarTodo(button) {
            const checkboxes = document.querySelectorAll('input[name="plataformas"]'); // Obtener todas las casillas
            checkboxes.forEach(checkbox => checkbox.checked = !allSelected); // Cambiar el estado de selección
            allSelected = !allSelected; // Alternar el estado
            button.textContent = allSelected ? 'Deseleccionar Todo' : 'Seleccionar Todo'; // Cambiar el texto del botón
        }

        // Función para exportar los combos generados a un archivo Excel
        function exportToExcel() {
            fetch('/export_to_excel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ combos: {{ combos|tojson }} }) // Convertir los combos a formato JSON
            })
            .then(response => response.blob()) // Recibir la respuesta como un archivo
            .then(blob => {
                const url = window.URL.createObjectURL(blob); // Crear una URL de objeto para el archivo
                const a = document.createElement('a'); // Crear un enlace oculto
                a.style.display = 'none';
                a.href = url;
                a.download = 'combos.xlsx'; // Nombre del archivo descargado
                document.body.appendChild(a);
                a.click(); // Simular clic para descargar
                window.URL.revokeObjectURL(url); // Liberar memoria
                alert('Generación exitosa'); // Mostrar mensaje de éxito
            });
        }

        // Función para copiar el contenido de la tabla al portapapeles
        function copyTable() {
            const table = document.querySelector('.combo-table');
            const range = document.createRange();
            range.selectNode(table);
            window.getSelection().removeAllRanges(); // Clear current selection
            window.getSelection().addRange(range); // Select the table
            document.execCommand('copy');
            window.getSelection().removeAllRanges(); // Unselect the table
            alert('Tabla copiada al portapapeles');
        }

        // Función para mostrar el modal
        function showModal() {
            document.getElementById('modal').style.display = 'block';
        }

        // Función para cerrar el modal
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Función para limpiar el formulario y ocultar la tabla de combos generados
        function resetForm() {
            document.querySelector('form').reset(); // Reinicia los valores del formulario
            document.getElementById('combos-section').style.display = 'none'; // Oculta la sección de combos generados
        }
    </script>
</head>
<body>
    <div class="header-container">
        <img src="{{ url_for('static', filename='KD2 soluciones.png') }}" alt="Logo" class="logo"> <!-- Logo de la empresa -->
        <h1>Generador de Combos de Streaming</h1> <!-- Título principal -->
    </div>

    <div class="form-container">
        <!-- Formulario para la generación de combos -->
        <form method="post">
            <!-- Campo para ingresar la cantidad de combos a generar -->
            <div class="form-group">
                <label for="total_combos">Cantidad de Combos (1-40):</label>
                <input type="number" name="total_combos" min="1" max="40" required>
            </div>

            <!-- Campo para ingresar el nombre base del combo -->
            <div class="form-group">
                <label for="nombre_base">Nombre Base del Combo:</label>
                <input type="text" name="nombre_base" required>
            </div>

            <!-- Campo opcional para elegir una plataforma inicial dentro del combo -->
            <div class="form-group">
                <label for="plataforma_inicio">Plataforma de Inicio (Opcional):</label>
                <input type="text" name="plataforma_inicio">
            </div>

            <!-- Campo para elegir la plataforma final (usualmente un obsequio) -->
            <div class="form-group">
                <label for="plataforma_fin">Plataforma Final:</label>
                <input type="text" name="plataforma_fin" required>
            </div>

            <!-- Sección para seleccionar las plataformas disponibles -->
            <h3>Selecciona las plataformas:</h3>

            <!-- Botón para seleccionar o deseleccionar todas las plataformas de la lista -->
            <div class="button-container">
                <button type="button" onclick="toggleSeleccionarTodo(this)">Seleccionar Todo</button>
            </div>

            <!-- Lista de plataformas representadas como checkboxes -->
            <div class="platforms-container">
                {% for plataforma in plataformas %}
                    <div class="platform-item">
                        <input type="checkbox" name="plataformas" value="{{ plataforma }}"> {{ plataforma }}
                    </div>
                {% endfor %}
            </div>

            <br>

            <!-- Botón para enviar el formulario y generar los combos -->
            <div class="button-container">
                <input type="submit" value="Generar Combos" class="btn">
            </div>
        </form>
    </div>

    <!-- Sección que se muestra solo si hay combos generados -->
    {% if combos %}
        <div id="combos-section">
            <!-- Botón para mostrar la vista previa de los combos generados -->
            <div class="button-container">
                <button class="btn-green" onclick="showModal()">Vista Previa</button>
            </div>
        </div>
    {% endif %}

    <!-- Modal para mostrar la tabla de combos generados -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Combos Generados</h2>
            <table class="combo-table">
                <thead>
                    <tr>
                        <th>Nombre del Combo</th>
                        <th>Descripción</th>
                        <th style="text-align: right;">Costo</th>
                    </tr>
                </thead>
                <tbody>
                {% for combo in combos %}
                    <tr>
                        <td><strong>{{ combo[0] }}</strong></td>
                        <td>{{ combo[1] }}</td>
                        <td>${{ combo[2] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <div class="button-container">
                <button class="btn-green" onclick="copyTable()">Copiar Tabla</button>
                <button class="btn-green" onclick="exportToExcel()">Exportar a Excel</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; Grupo Empresarial DK SAS <img src="{{ url_for('static', filename='eagle.png') }}" alt="Eagle"></p>
    </div>
</body>
</html>
